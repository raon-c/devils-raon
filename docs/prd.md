# 저격 홀덤 Web - PRD

## 목차

1.  [제품 개요](#1-제품-개요)
2.  [벤치마킹 서비스 및 근거](#2-벤치마킹-서비스-및-근거)
3.  [핵심 기능 - 규격](#3-핵심-기능---규격)
4.  [제안 기능 (MVP 이후 고려)](#4-제안-기능-mvp-이후-고려)
5.  [사용자 페르소나와 활용 시나리오](#5-사용자-페르소나와-활용-시나리오)
6.  [기술 스택 및 아키텍처 개요](#6-기술-스택-및-아키텍처-개요)

---

## 1. 제품 개요

저격 홀덤 Web은 넷플릭스 예능 〈데블스 플랜〉에 등장한 '저격 홀덤'을 실시간 멀티플레이 웹 게임으로 구현하는 프로젝트입니다.

-   **목표**: 어디서나 브라우저만으로 게임에 즉시 참여하고, 실시간으로 카드·칩·저격 정보를 동기화하며 승부를 즐길 수 있는 최소 기능 제품(MVP)을 제공합니다.
-   **플레이 방식**: 2 ~ 6명의 플레이어가 턴별로 베팅·저격·쇼다운을 거쳐 칩을 획득, 칩 75개로 생존 확정 후 최종 승자를 가립니다. (상세 규칙: `game-rule.md`)
-   **차별점**:
    1.  **저격 시스템**: 족보와 최고 숫자를 선언하여 상대방의 패를 강등시키는 독특한 전략적 요소.
    2.  **간소화된 카드**: 1-10 숫자 카드 4세트(총 40장)를 사용하여 진입 장벽을 낮춤.
    3.  **생존 및 탈락 구조**: 배틀로얄 형식으로 긴장감을 유지하며, 75칩으로 생존을 확정짓는 목표 제공.

---

## 2. 벤치마킹 서비스 및 근거

| 서비스                       | 참조 포인트                                       | 적용 근거                                                                                                |
|------------------------------|---------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| Zynga Poker                  | 실시간 소켓 기반 동기화, 캐주얼 UI, 소셜 기능         | 대규모 동시 접속 처리 경험 및 실시간 소켓 아키텍처는 안정적인 서비스 운영에 참고 가치가 높음.                                                   |
| Supabase Realtime 데모 게임    | Next.js + Supabase Realtime 멀티플레이어 게임 예시 | 동일 기술 스택(부분적)을 사용한 Presence, Broadcast, DB 트리거를 통한 플레이어 상태 즉시 반영 구현 패턴 검증.                                  |
| Hearthstone (Blizzard)       | 매치메이킹, 클라이언트-서버 결정권 분리                | 서버 단일 진실 공급원(SoT) 원칙을 유지하며 클라이언트는 UI/UX에 집중하는 구조는 부정행위 방지 및 유지보수 용이성에 기여.                               |

---

## 3. 핵심 기능 - 규격

| 카테고리 | 세부 기능                                                                                                                                                                                                                           | 주요 규격                                                                                                                                                                                                                                                                |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **계정 관리**    | • 사용자 등록 (닉네임) 및 인증                                                                                                                                                                                                             | Supabase Auth (Magic Link 또는 유사 간편 인증), JWT 기반 세션 관리. 사용자 정보는 `Users` 테이블에 저장. (`FN-001`)                                                                                                                                                           |
| **게임 방 관리**  | • 방 생성 (호스트 자동 참여)<br>• 방 코드 기반 참여<br>• 로비 내 플레이어 목록 표시<br>• 플레이어 퇴장 처리 (호스트 이전 포함)<br>• 게임 시작 (호스트 전용, 최소 인원 충족 시)                                                                                               | 고유 방 코드(`GameRooms.room_code`). 최대 6명. 방 상태(`RoomStatuses`) 및 플레이어 상태(`PlayerStatuses`) 관리. (`FN-003` ~ `FN-008`)                                                                                                                                   |
| **실시간 동기화** | • 플레이어 입장/퇴장 Presence (`FN-011`)<br>• 게임 상태 변경 (카드 분배, 베팅, 저격, 칩 이동, 턴 변경 등) Broadcast (`FN-010`)<br>• 로비 상태 (참여 인원, 방 상태) Broadcast                                                                                             | Supabase Realtime (Channels, Presence) 사용. 지연 시간 ≤ 150ms 목표.                                                                                                                                                                                                     |
| **게임 상태 머신** | • `Lobby` → `GameInProgress` (`ReadyToStartRound` → `DealingPersonalCards` → `DealingSharedCards1` → `Betting1` → `DealingSharedCards2` → `Betting2` → `Sniping` → `Showdown` → `Settlement`) → `GameEnded` (상세 `docs/fsm.md` 및 `db-schema.md`의 `game_phase` 참조) | XState 활용, 서버 권위적 FSM 실행 (Supabase Edge Function). FSM 컨텍스트는 `docs/fsm.md` 정의 따름. 각 단계별 데이터는 DB에 저장 (`GameRounds`, `PlayerHands` 등).                                                                                                       |
| **카드 관리**    | • 40장 덱 (1-10 숫자 x 4세트) 생성 및 셔플 (`FN-025`)<br>• 개인 카드 2장 분배 (`PlayerHands` 저장) (`FN-013`)<br>• 공유 카드 총 4장 순차적 공개 (`SharedCards` 저장) (`FN-014`, `FN-016`)                                                                              | 카드 정보는 `INTEGER`로 저장.                                                                                                                                                                                                                                        |
| **베팅 시스템**   | • 베팅 라운드 (Betting1, Betting2) 진행 (`FN-015`)<br>• 액션: 베팅, 콜, 레이즈, 폴드, 체크<br>• 최소/최대 베팅 한도 (게임 규칙 따름)<br>• 베팅 기록 (`Bets` 테이블)                                                                                                       | 칩은 `INTEGER`. 게임 규칙(`game-rule.md`) 및 `fsm.md`의 베팅 로직 따름.                                                                                                                                                                                                |
| **조합 계산**    | • 6장(공유 4 + 개인 2) 중 최상위 5장 패 자동 판별 (`FN-019`)<br>• 최종 패 구성 카드 및 족보 저장 (`FinalHandCompositionCards`, `PlayerHands.hand_rank_id`)                                                                                | 서버 사이드 TypeScript 라이브러리 (또는 Edge Function 내 로직)로 결정. `HandRanks` 참조. (`game-rule.md` 족보 순위)                                                                                                                                                        |
| **저격 로직**    | • 특정 족보 및 해당 족보의 가장 높은 숫자 선언 (`FN-017`)<br>• 저격 선언 기록 (`Snipes` 테이블)<br>• 쇼다운 시 저격된 패는 최하위로 간주 (`FN-018`)                                                                                                     | 서버에서 유효성 검증 후 FSM에 반영. (`fsm.md`, `game-rule.md` 참조)                                                                                                                                                                                               |
| **생존/탈락 처리**| • 75칩 이상 보유 시 생존 확정 (칩 75개 지불) (`FN-020`)<br>• 생존자 잔여 칩 분배 규칙 적용 (`FN-021`)<br>• 0칩 보유 시 탈락 처리                                                                                                               | `GameParticipants.chips` 및 `status` 업데이트. 트랜잭션 보장 (Prisma). (`game-rule.md` 규칙 11, 12)                                                                                                                                                                        |
| **게임 종료**    | • 게임 종료 조건 충족 시 처리 (`FN-022`, `FN-023`)<br>• 최종 승자 발표                                                                                                                                                                  | `GameRooms.status` 'FINISHED'로 업데이트.                                                                                                                                                                                                                                 |

---

## 4. 제안 기능 (MVP 이후 고려)

| 기능             | 기대 효과                                         | 비고                                                                 |
|------------------|---------------------------------------------------|----------------------------------------------------------------------|
| AI 튜토리얼 봇    | 신규 사용자의 게임 규칙 학습 지원, 진입 장벽 완화       | `Users.is_ai_bot` 필드 존재. FSM에 AI 플레이어 로직 연동 필요.            |
| 친구 초대 기능    | 소셜 기능 강화, 사용자 유입 증대                       | 특정 방으로 바로 초대할 수 있는 링크 공유 등.                               |
| 채팅 기능         | 플레이어 간 소통 증진, 게임 경험 향상                   | 간단한 텍스트 기반 채팅 또는 이모티콘.                                    |
| 랭킹/통계 시스템  | 사용자 재방문 유도, 경쟁 요소 강화                     | 승리 수, 누적 칩, 저격 성공률 등 기반.                                 |
| 모바일 PWA 지원   | 설치 없이 앱과 유사한 사용 경험 제공, 접근성 향상        | Next.js PWA 기능 활용.                                                |

---

## 5. 사용자 페르소나와 활용 시나리오

### ① '경쟁을 즐기는 29세 프론트엔드 개발자'

*   **상황**: 점심시간 또는 휴식 시간에 팀원들과 가볍게 즐길 수 있는 두뇌 플레이 게임을 찾고 있음.
*   **행동**:
    1.  웹 브라우저로 게임 사이트에 접속하여 간단히 닉네임을 설정하고 로그인.
    2.  [방 만들기]를 통해 새 게임 방을 생성하고, 생성된 방 코드를 팀 동료에게 공유.
    3.  동료들이 모두 참여하면 [게임 시작] 버튼을 눌러 게임 시작.
    4.  실시간으로 공유되는 카드와 다른 플레이어들의 베팅 상황을 보며 자신의 패와 전략에 따라 베팅 또는 저격을 시도.
    5.  라운드 종료 후 정산 결과를 확인하고 다음 라운드 진행.
    6.  최종적으로 생존하거나 가장 많은 칩을 획득하여 승리하는 것을 목표.
*   **니즈**: 빠른 게임 시작, 직관적인 UI, 실시간 반응성, 명확하고 예측 가능한 게임 규칙. (상세 UI 흐름: `story-board.md`)

---

## 6. 기술 스택 및 아키텍처 개요

*   **프론트엔드**: Next.js (App Router), TypeScript, Tailwind CSS, shadcn/ui
*   **상태 관리 (클라이언트)**: XState (또는 Zustand 고려)
*   **백엔드 (서버 로직)**: Supabase Edge Functions (TypeScript), XState (FSM 실행)
*   **실시간 통신**: Supabase Realtime (Channels, Presence)
*   **데이터베이스**: Supabase PostgreSQL + Prisma ORM
*   **인증**: Supabase Auth (Magic Link 또는 유사 간편 인증, JWT)
*   **배포/CI**: Vercel, GitHub Actions
*   **기타**: Playwright (E2E 테스트), ESLint, Prettier (코드 품질)

(상세 아키텍처는 `architect.md` 참조)

---

**참고 문서 목록**:

*   `architect.md`: 전체 시스템 아키텍처 설계
*   `db-schema.md`: 상세 데이터베이스 스키마 정의
*   `erd.md`: Entity Relationship Diagram
*   `fsm.md`: XState 기반 게임 상태 머신 설계
*   `functional-specification.md`: 기능 정의 문서
*   `game-rule.md`: 저격 홀덤 게임 규칙
*   `story-board.md`: 주요 화면 스토리보드

이 문서는 프로젝트의 핵심 요구사항과 제안 사항을 정의하며, 첨부된 상세 설계 문서들과 함께 프로젝트 진행의 기준으로 활용됩니다.
